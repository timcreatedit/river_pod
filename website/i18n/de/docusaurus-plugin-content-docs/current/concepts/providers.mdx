---
title: Provider
---

Jetzt, da wir [Riverpod] installiert haben, können wir über "Provider" sprechen.

Provider sind der wichtigste Teil einer [Riverpod] Anwendung.
Ein Provider ist ein Objekt, das einen "State" enthält und es ermöglicht, diesem State zuzuhören.

## Warum sollte ich Provider benutzen?

Das Verpacken eines States in einem Provider bringt folgende Vorteile:

- Einfacher Zugriff auf den State von verschiedenen Orten aus.
  Provider sind ein vollständiger Ersatz für Patterns wie Singletons,
  Service Locators, Dependency Injection, oder InheritedWidgets.

- Vereinfacht das Kombinieren des States mit Anderen.
  Hatten Sie schonmal Schwierigkeiten, mehere Objekte in einem zusammenzuführen?
  Dieses Szenario ist direkt in die Provider eingebaut und die entsprechende
  Syntax ist einfach.

- Ermöglicht Performance Optimierungen.
  Ob es um das Filtern von Widget Rebuilds geht, oder darum, teure Berechnungen zu cachen,
  Provider stellen sicher, dass nur die Dinge neu berechnet werden, die von einer Änderung des States
  betroffen sind.

- Verbessert die Testbarkeit Ihrer Anwendung.
  Mit Providern brauchen Sie keine komplexen `setUp`/`tearDown` Schritte. Zusätzlich kann
  jeder Provider so überschrieben werden, dass er sich während Tests anders verhält, was
  es ermöglicht, sehr spezifisches Verhalten abzutesten.

- Einfache Integration mit fortgeschrittenen Features wie Logging oder pull-to-refresh.


## Einen Provider erzeugen

Es gibt viele Varianten von Providern, aber alle funktionieren auf die gleiche Weise.

Der verbreitetste Anwendungsfall ist, sie als globale Konstanten zu deklarieren:

```dart
final myProvider = Provider((ref) {
  return MyValue();
});
```

:::note
Lassen Sie sich nicht vom der globalen Natur solcher Provider abschrecken.
Provider sind vollständig unveränderbar. Einen Provider zu deklarieren unterscheidet sich nicht
davon, eine Funktion zu deklarieren und ist sowohl testbar, als auch einfach zu verwalten.
:::

Dieses Snippet setzt sich aus drei Komponenten zusammen:

- `final myProvider`, die Deklaration einer globalen Variable.
  Diese Variable werden wir in Zukunft benutzen um den State eines Providers auszulesen.
  Sie sollte stets unveränderbar (final) sein.

- `Provider`, der die Art von Provider für die wir uns entschieden haben.
  [Provider] ist der einfachste aller Provider. Er stellt einen Wert zur Verfügung,
  der sich nie ändert.
  Wir könnten [Provider] mit anderen Providern wie [StreamProvider] oder 
  [StateNotifierProvider] ersetzen um zu verändern, wie mit dem Wert interagiert wird.

- Eine Funktion, die den geteilten State erstellt.
  Diese Funktion erhält immer ein Objekt mit dem Namen `ref` als Parameter.
  Dieses Objekt erlaubt es, anderen Providern zuzuhören, oder verschiedene Operationen
  durchzuführen wenn der State unseres Providers zerstört werden soll.

Der Typ des Objekts, welches von der Funktion erzeugt wird hängt von der Art des
verwendeten Providers ab.
Die Funktion eines [Provider]s zum Beispiel kann jede Art von Objekt erzeigen.
Im Gegensatz dazu, muss der Callback eines [StreamProvider]s einen [Stream] zurückgeben.

:::info
Sie können beliebig viele Provider erzeugen, ohne Einschränkungen.
You can declare as many providers as you want without limitations.
Anders als bei der Verwendung von `package:provider`, können in [Riverpod]
mehrere Provider States vom gleichen Typ erzeugen:

```dart
final cityProvider = Provider((ref) => 'London');
final countryProvider = Provider((ref) => 'England');
```

Hier ist es kein Problem, dass beide Provider einen `String` erzeugen.
:::

:::caution
Damit Provider funktionieren, muss [ProviderScope] die Wurzel des Widget-Trees Ihrer Anwendung sein.
Flutter Anwendungen:

```dart
void main() {
  runApp(ProviderScope(child: MyApp()));
}
```

:::

## Aktionen ausführen bevor der State zerstört wird

In manchen Fällen kann der State eines Providers zerstört oder neu erzeugt werden.
Ein verbreiteter Usecase ist es, etwas aufzuräumen bevor der State zerstört wird.
Das Schließen eines `StreamController`s ist ein Beispiel hierfür.

Das `ref` Objekt, welches dem Callback aller Provider übergeben wird ermöglicht dies mit seiner [onDispose] Methode.

Das folgende Beispiel verwendet [onDispose] um einen `StreamController` zu schließen:

```dart
final example = StreamProvider.autoDispose((ref) {
  final streamController = StreamController<int>();

  ref.onDispose(() {
    // Schließt den StreamController, sobald der State dieses Providers zerstört wird.
    streamController.close();
  });

  return streamController.stream;
});
```

:::note
Je nachdem welcher Provider verwendet wird, kann sich dieser unter Umständen selbst um das
Aufräumen kümmern.
Ein, [StateNotifierProvider] wird beispielsweise die `dispose` Methode des entsprechenden `StateNotifier`s rufen.
:::

## Provider Modifikatoren

Alle Provider haben eingebaute Wege um ihnen zusätzliche Funktionalität hinzuzufügen.

Sie können neue Features zum `ref` Objekt hinzufügen, oder abändern, wie ein Provider konsumiert wird.
Modifikatoren können mit allen Providern verwendet werden, die Syntax ähnelt hierbei der von "named constructors".

```dart
final myAutoDisposeProvider = StateProvider.autoDispose<int>((ref) => 0);
final myFamilyProvider = Provider.family<String, int>((ref, id) => '$id');
```

Zu diesem Zeitpunkt stehen zwei Modifikatoren zur Verfügung:

- [`.autoDispose`](/docs/concepts/modifiers/auto_dispose) führt dazu, dass der Provider seinen State automatisch zerstört,
  wenn er keine Zuhörer mehr hat.
- [`.family`](/docs/concepts/modifiers/family) erlaubt es, Provider mit übergebenen Parametern zu erzeugen.

:::note
Ein Provider kann mehrere Modifikatoren verwenden:

```dart
final userProvider = FutureProvider.autoDispose.family<User, int>((ref, userId) async {
  return fetchUser(userId);
});
```

:::

Das war's für diese Anleitung!

Sie können fortfahren mit [Auslesen von Providern](/docs/concepts/reading).
Alternativ können Sie sich [Kombinieren von Providern](/docs/concepts/combining_providers) ansehen.

[get_it]: http://pub.dev/packages/get_it
[inheritedwidget]: https://api.flutter.dev/flutter/widgets/InheritedWidget-class.html
[stream]: https://api.dart.dev/stable/2.8.4/dart-async/Stream-class.html
[ondispose]: https://pub.dev/documentation/riverpod/latest/riverpod/Ref/onDispose.html
[riverpod]: https://github.com/rrousselgit/river_pod
[hooks_riverpod]: https://pub.dev/packages/hooks_riverpod
[flutter_riverpod]: https://pub.dev/packages/flutter_riverpod
[flutter_hooks]: https://github.com/rrousselGit/flutter_hooks
[provider]: ../providers/provider
[streamprovider]: https://pub.dev/documentation/riverpod/latest/riverpod/StreamProvider-class.html
[statenotifierprovider]: ../providers/state_notifier_provider
[providerscope]: https://pub.dev/documentation/flutter_riverpod/latest/flutter_riverpod/ProviderScope-class.html
